<script src="/assets/jquery.gmap.min.js" type="text/javascript"></script>
<div class="map">
  <div id="openCloseIdentifier"></div>
  <div id="map"></div>
  <div id="map-toggle"></div>
</div>
<div id="map-rect"></div>
<script type="text/javascript" charset="utf-8">
  $("#map-toggle").click( function() {
		if ($("#openCloseIdentifier").is(":hidden")) {
			$(this).removeClass("open");
			$(this).animate({height: "65px"}, 0);
			$(this).animate({marginTop: "310px"}, 0);
			$("#map").animate({height: "65px"}, 300);
			$(this).animate({marginTop: "0px"}, 300);
			$("#map-rect").animate({height: "10px"}, 300);
			$("#openCloseIdentifier").show();
		}
		else {
			$(this).animate({height: "10px"}, 0);
			$(this).animate({marginTop: "60px"}, 0);
			if($('#map').data('gmap')) {
			  $("#map").animate({height: "365px"}, 300);
			} else {
			  $("#map").animate({height: "365px"}, 0, function() {
  			  $('#map').gMap({markers:<%= raw @markers %>, zoom: 'fit', latitude:'fit', longitude:'fit'});
  			});
			}
			$(this).animate({marginTop: "355px"}, 300);
			$("#map-rect").animate({height: "310px"}, 300);
			$("#openCloseIdentifier").hide();
			$(this).addClass("open");
		}
	});
</script>